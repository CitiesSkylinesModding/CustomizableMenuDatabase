name: Upload CustomizableMenuData.json to S3

on:
    push:
        paths:
            - "CustomizableMenuData.json"

jobs:
    upload:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Configure R2 (S3-compatible) credentials
              uses: aws-actions/configure-aws-credentials@v4
              with:
                  aws-access-key-id: ${{ secrets.R2_ACCESS_KEY_ID }}
                  aws-secret-access-key: ${{ secrets.R2_SECRET_ACCESS_KEY }}
                  aws-region: auto

            - name: Upload file to R2
              env:
                  R2_BUCKET_NAME: ${{ vars.R2_BUCKET_NAME }} # 在仓库/组织的变量里配置 bucket 名
              run: |
                  aws s3 cp \
                    CustomizableMenuData.json \
                    s3://$R2_BUCKET_NAME/CustomizableMenuData.json \
                    --endpoint-url https://b28dccb288bc2c16028f4d11ede9a4de.r2.cloudflarestorage.com
